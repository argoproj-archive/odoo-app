---
type: workflow
version: 1
name: odoo-workflow-with-rds
description: This is the workflow to deploy Odoo

inputs:
  parameters:
    APP_NAME:
      default: "odoo-rds-with-vols"
    APP_VOL_NAME:
      default: "odoo-rds"
    DBHOST:
    USER:
      default: "odoo"
    PASSWORD: 
      default: "password"

steps:
- deploy-odoo:
        template: odoo-rds-deployment-with-vols

---
type: deployment
version: 1
name: odoo-rds-deployment-with-vols
description: odoo deployment

application_name: "%%inputs.parameters.APP_NAME%%"
deployment_name: "odoo-deploy"

inputs:
  parameters:
    APP_NAME:
        default: "odoo-app-vol"
    APP_VOL_NAME:
    DBHOST:
    USER:
    PASSWORD:

volumes:
  app-vol:
    name: "%%inputs.parameters.APP_VOL_NAME%%"

scale:
  min: 1

external_routes:
- dns_prefix: "odoords"
  target_port: 8069
  ip_white_list:
  - 0.0.0.0/0

containers:
  odoo-rds-container:
    inputs:
      volumes:
        app-vol:
          from: "%%volumes.app-vol%%"
          mount_path: /var/lib/odoo
    image: "odoo:latest"
    env:
    - name: HOST
      value: "%%inputs.parameters.DBHOST%%"
    - name: POSTGRES_USER
      value: "%%inputs.parameters.USER%%"
    - name: POSTGRES_PASSWORD
      value: "%%inputs.parameters.PASSWORD%%"
    resources:
      mem_mib: 1024
      cpu_cores: 0.5
